---
title: "Golang goroutine"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "ã‚³ãƒ³ã‚«ãƒ¬ãƒ³ã‚·ãƒ¼"]
published: false
---

# ã‚³ãƒ³ã‚«ãƒ¬ãƒ³ã‚·ãƒ¼ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
## ï¼’ã¤ã®ã‚¹ã‚¿ã‚¤ãƒ«
Go ã«ã¯ã€ã‚³ãƒ³ã‚«ãƒ¬ãƒ³ã‚·ãƒ¼(ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒ )ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒ 2 ã¤ã‚ã‚‹ã€‚
- ä¸€ã¤ã¯ä»–ã®è¨€èªåŒæ§˜ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¾“æ¥ã®ã‚¹ã‚¿ã‚¤ãƒ«ã€‚
- ã‚‚ã†ä¸€ã¤ã¯goroutine ã¨ã„ã†ç‹¬ç«‹ã—ãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£é–“ã§å€¤ãŒæ¸¡ã•ã‚Œã‚‹ Goç‹¬è‡ªã®ã‚¹ã‚¿ã‚¤ãƒ«ã€‚

## Goç‹¬è‡ªã®ã‚¹ã‚¿ã‚¤ãƒ« goroutineã®æ¦‚å¿µ
ã‚³ãƒ³ã‚«ãƒ¬ãƒ³ã‚·ãƒ¼(ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒ )ã‚’ä½œæˆã™ã‚‹éš›ã®æœ€å¤§ã®å•é¡Œã¯ã€ãƒ—ãƒ­ã‚»ã‚¹é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã€‚
Goã§ã¯é€šä¿¡ã‚’ä»‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ãŒã‚„ã‚Šå–ã‚Šã•ã‚Œã€ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã¯ 1 ã¤ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ (goroutine) ã®ã¿ã€‚ã“ã®ç‚ºã€è¨­è¨ˆä¸Šã€ç«¶åˆçŠ¶æ…‹ã¯ç™ºç”Ÿã—ãªã„ã€‚
ã“ã®æ¦‚å¿µã¯ã€Effective Goã«ã¯ä»¥ä¸‹ã®æ§˜ã«è¦ç´„ã•ã‚Œã¦ã„ã‚‹ã€‚
>ãƒ¡ãƒ¢ãƒªã‚’å…±æœ‰ã—ã¦é€šä¿¡ã—ãªã„ã§ãã ã•ã„ã€‚ä»£ã‚ã‚Šã«ã€é€šä¿¡ã—ã¦ãƒ¡ãƒ¢ãƒªã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

## goroutineã®æ§‹æ–‡

```go
go some_func()
```

ãƒ©ãƒ ãƒ€é–¢æ•°ã§ä½¿ç”¨ã™ã‚‹äº‹ãŒå¥½ã¾ã‚Œã‚‹
```go
go func() {
    some_func()
}()
```

## ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä½œæˆä¾‹

```go
package main

import (
	"fmt"
	"net/http"
	"time"
)

func callAPI(api string) {
	_, err := http.Get(api)
	if err != nil {
		fmt.Printf("ERROR: %s\n", api)
		return
	}

	fmt.Printf("SUCCESS: %s\n", api)
}

func main() {
	start := time.Now()

	apis := []string{
		"https://api.github.com",
		"https://api.rstliz.com/",
		"https://api.twitter.com/",
	}

	for _, api := range apis {
		go callAPI(api)
	}

	time.Sleep(3 * time.Second)

	elapsed := time.Since(start)
	fmt.Printf("çµŒéæ™‚é–“ %v ç§’\n", elapsed.Seconds())
}
```

## ãƒãƒ£ãƒãƒ«
goroutine ã‹ã‚‰åˆ¥ã® goroutine ã«å€¤ã‚’é€ä¿¡ã™ã‚‹ã«ã¯ã€ãƒãƒ£ãƒãƒ«ã‚’ä½¿ç”¨ã™ã‚‹

### æ§‹æ–‡
```go
# make(chan <ãƒãƒ£ãƒãƒ«ã‚’é€šéã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹>)
ch := make(chan int)
```

#### é€å—ä¿¡
ãƒãƒ£ãƒãƒ«å†…ã®ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã¨ãƒ‡ãƒ¼ã‚¿å—ä¿¡ã¯ãƒ–ãƒ­ãƒƒã‚¯æ“ä½œ
```go
ch <- x // ãƒãƒ£ãƒãƒ«ã‚’é€šã—ã¦xã‚’é€ä¿¡
x = <-ch // ãƒãƒ£ãƒãƒ«ã‚’é€šã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã€xã§å—ã‘å–ã‚‹
<-ch // ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ãŒç ´æ£„ã™ã‚‹
```

#### é–‰ã˜ã‚‹
```go
close(ch)
```
é–‰ã˜ãŸãƒãƒ£ãƒãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€é€ä¿¡ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã‚‹


```go
package main

import (
	"fmt"
	"net/http"
	"time"
)

func callAPI(api string, ch chan string) {
	_, err := http.Get(api)
	if err != nil {
		ch <- fmt.Sprint("ERROR: %s\n", api)
		return
	}

	ch <- fmt.Sprint("SUCCESS: %s\n", api)
}

func main() {
	start := time.Now()

	apis := []string{
		"https://api.github.com",
		"https://api.rstliz.com/",
		"https://api.twitter.com/",
	}

	ch := make(chan string)

	for _, api := range apis {
		go callAPI(api, ch)
	}
	fmt.Print(<-ch)


	elapsed := time.Since(start)
	fmt.Printf("çµŒéæ™‚é–“ %v ç§’\n", elapsed.Seconds())
}
```