---
title: "h2.jdbc.JdbcSQLSyntaxErrorException: SQLステートメントに文法エラーがあります"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["H2", "SQL", "Kotlin", "Java", "SpringBoot", "JPA"]
published: true
---

# H2 DB使用時に発生した文法エラーを解決する

## 問題
H2 DB使用時に文法エラーが発生し、SQLを実行できない。
```
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: SQLステートメントに文法エラーがあります "create table [*]user (id integer generated by default as identity, name varchar(255), primary key (id))"; 期待されるステートメント "identifier"
Syntax error in SQL statement "create table [*]user (id integer generated by default as identity, name varchar(255), primary key (id))"; expected "identifier"; SQL statement:
```

## 状況
SQLはJPAが自動生成している。

```kotlin
import javax.persistence.Entity
import javax.persistence.GeneratedValue
import javax.persistence.GenerationType
import javax.persistence.Id

@Entity
data class User(
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	var id: Int = 0,
	var name: String = ""
)
```

```kotlin
import org.springframework.data.repository.CrudRepository

interface UserRepository : CrudRepository<User, Int>
```

## 原因
エラー文中の`[*]` はこの周辺に問題があることをしめしている。
今回は`[*]user`なので、user周辺に問題がある事がわかる。
そして「user」はH2の予約後であるので、クォート等で囲う必要がある。
http://www.h2database.com/html/advanced.html#keywords

## 解決
今回は接続時の設定にNON_KEYWORDSを設定する。
```
spring.datasource.url=jdbc:h2:mem:testdb;NON_KEYWORDS=USER
```
ただし、公式のドキュメントによると「可能であれば、引用符付きの識別子」を使用してほしいとのこと。
https://www.h2database.com/html/commands.html#set_non_keywords


