---
title: "MySQL å†å¸°ã‚¯ã‚¨ãƒªã§éšå±¤æ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€åº¦ã«å–å¾—"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: true
---

# æº–å‚™

## ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
```
CREATE TABLE `categories` (
  `id` int(10) unsigned NOT NULL,
  `name` varchar(45) NOT NULL,
  `parent_id` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`parent_id`) REFERENCES `categories` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB;
```

## æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥
```
INSERT INTO `categories`
(`id`, `name`, `parent_id`)
VALUES
(1, "Fashion", NULL),
(2, "Mens", 1),
(3, "Ladies", 1),
(4, "Tops", 2),
(5, "Shirts", 4),
(6, "Food", NULL),
(7, "Water", 6),
(8, "Meet", 6),
(9, "Sweets", 6)
;
```

# ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
## æ§‹æ–‡
```
with recursive R as (
  select anchor_data -- å–å¾—1è¡Œç›®ã“ã“ãŒèµ·ç‚¹ã¨ãªã‚‹
  union [all]
  select recursive_partã€€-- å–å¾—2è¡Œç›®ä»¥é™ã€ã“ã“ãŒå†å¸°ã¨ãªã‚‹
  from R, ...
)
select ... -- å®Ÿè¡Œçµæœã®å–å¾—
```
## å®Ÿè¡Œ
ã¤ã„ã§ã«1è¡Œç›®ã®ã‚¯ã‚¨ãƒªã‹ã‚‰ã®éšå±¤æ·±åº¦ã‚‚å–å¾—ã§ãã‚‹å½¢ã«ã€‚
```
WITH recursive child(depth, id, parent, name) AS(
    SELECT
        0,
        id,
        parent_id,
        name
    FROM
        categories
    WHERE
        categories.id = 1
    UNION ALL
    SELECT
        child.depth + 1,
        categories.id,
        categories.parent_id,
        categories.name
    FROM
        categories,
        child
    WHERE
        categories.parent_id = child.id
)
SELECT
    depth,
    id,
    parent,
    name
FROM
    child
ORDER BY
    depth
;
```
## çµæœ
```
+-------+------+--------+---------+
| depth | id   | parent | name    |
+-------+------+--------+---------+
|     0 |    1 |   NULL | Fashion |
|     1 |    3 |      1 | Ladies  |
|     1 |    2 |      1 | Mens    |
|     2 |    4 |      2 | Tops    |
|     3 |    5 |      4 | Shirts  |
+-------+------+--------+---------+
```
